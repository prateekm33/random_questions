<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Nebula</title>
    <script src="https://www.gstatic.com/firebasejs/5.9.3/firebase.js"></script>
    <script src="https://unpkg.com/vue"></script>
    <link rel="stylesheet" href="main.css" type="text/css">
  </head>
  <body>
    <script>
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyDaUOPPJYyJQN6R5Fe75AjB4MuSkfI-KU0",
        authDomain: "nebula-8f15d.firebaseapp.com",
        databaseURL: "https://nebula-8f15d.firebaseio.com",
        projectId: "nebula-8f15d"
      };
      firebase.initializeApp(config);
    </script>
    <div id="app-container">
      <div v-if="!!name_submission || !!already_answered" id="modal-msg-container">
        <div id="name-sub" v-if="!!name_submission">
          <div>Enter your name to submit</div>
          <div id="name-input-container"><input placeholder="Name" id="name-input" :value="user"><div>Required</div></div>
          <div class="button-container">
            <button @click="done">Done</button>
            <button @click="cancel">Cancel</button>
          </div>
        </div>
        <div v-if="!!already_answered" id="already-answered">
          <div>You've already answered this question</div>
          <button @click="close">Close</button>
        </div>
      </div>
      <div id="app-main">
        <div v-if="question !== null" id="question-container">
          <div>{{ question.query }}</div>
          <ul>
            <div v-for="(op, index) in question.options">
              <input type="radio" :value="index" name="question" class="question-radio" @click="setRadioOption">{{ op }}</input>
            </div>
          </ul>
        </div>
        <div><button @click="submit" style="margin-right: 10px;">Submit</button><button @click="next" style="margin-left: 10px;">Next Question</button></div>

        <div v-if="show_stats" id="stats-container">
          <div id="main-stats-header">QUESTION STATS</div>
          <div id="stats-header-caption">Your answer: {{ question.options[selected] }}</div>
          <div id="stats-inner-container">
            <div class="table-section">
              <div class="table-header">Breakdown by Individuals</div>
              <div>Total Responses: {{ responses.length }}</div>
              <div id="page-count-select">
                <div>Responses per Page: </div>
                <select @change="changePageViewCount">
                  <option value="5" :selected="maxIndPageSize === 5 ? 'true' : ''">5</option>
                  <option value="10" :selected="maxIndPageSize === 10 ? 'true' : ''">10</option>
                  <option value="20" :selected="maxIndPageSize === 20 ? 'true' : ''">20</option>
                  <option value="25" :selected="maxIndPageSize === 25 ? 'true' : ''">25</option>
                </select>
              </div>
              <div class="table">
                <div class="row header-row">
                  <div>Participant</div><div>Response</div>
                </div>
                <div v-for="resp in disp_responses" class="row" :style="[{ background: colors[resp.option_idx], padding: '10px' }]">
                  <div>{{ resp.user_id }}</div><div>{{ question.options[resp.option_idx] }}</div>
                </div>
              </div>
              <div class="button-container">
                <button @click="prevIndTable" :disabled="prevIndTableDisabled">Prev</button>
                <div>Page {{ Math.floor(indTableCursor / maxIndPageSize) + 1}} / {{ Math.floor(responses.length / maxIndPageSize) + 1 }}</div>
                <button @click="nextIndTable" :disabled="nextIndTableDisabled">Next</button>
              </div>
            </div>

            <div class="table-section">
              <div class="table-header">Breakdown by Answer</div>
              <div class="table">
                <div class="row header-row">
                  <div>Answer</div><div>Count (Percentage)</div>
                </div>
                <div v-for="(resp, index) in ans_responses" class="row" :style="[{ background: resp.color, padding: '10px' }]">
                  <div>{{ question.options[index] }}</div>
                  <div>{{ resp.count }} <span>({{ resp.percentage.toFixed(2) }}%)</span></div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
    <script src="main.js"></script>
  </body>
</html>
